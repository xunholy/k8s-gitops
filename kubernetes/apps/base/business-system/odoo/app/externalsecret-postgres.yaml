---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: odoo-pg-superuser
  namespace: database-system
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  refreshInterval: 1h
  target:
    name: odoo-pg-superuser
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        username: "{{ .SUPERUSER_USERNAME }}"
        password: "{{ .SUPERUSER_PASSWORD }}"
  dataFrom:
    - extract:
        key: odoo-postgres
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: odoo-pg-app
  namespace: database-system
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  refreshInterval: 1h
  target:
    name: odoo-pg-app
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        username: "{{ .APP_USERNAME }}"
        password: "{{ .APP_PASSWORD }}"
        dbname: "{{ .POSTGRES_DB }}"
  dataFrom:
    - extract:
        key: odoo-postgres
---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: odoo-pg-backup
  namespace: database-system
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  refreshInterval: 1h
  target:
    name: odoo-pg-backup
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        gcsApplicationCredentials: "{{ .GCS_SERVICE_ACCOUNT_JSON }}"
  dataFrom:
    - extract:
        key: odoo-postgres-backup
