---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: odoo-weekly
  namespace: velero
spec:
  # Weekly Sunday 04:00 Melbourne time (AEDT) - 1 hour after CNPG backup
  # 04:00 AEDT = 17:00 UTC Saturday (UTC+11 in summer)
  schedule: "0 17 * * 6"
  template:
    # Backup business-system namespace
    includedNamespaces:
      - business-system

    # Include specific resources
    includedResources:
      - persistentvolumeclaims
      - persistentvolumes
      - pods
      - deployments
      - statefulsets
      - configmaps
      - secrets

    # NOTE: No labelSelector - backup entire namespace to include CNPG PVCs
    # (CNPG PVCs have app.kubernetes.io/name=postgresql, not odoo)

    # Snapshot PVCs
    snapshotVolumes: true
    storageLocation: gcs
    volumeSnapshotLocations:
      - csi-ceph-blockpool

    # Retention: 30 days (keep ~4 weekly backups)
    ttl: 720h

    # Hooks enabled via pod annotations
    hooks:
      resources: []

  useOwnerReferencesInBackup: false
