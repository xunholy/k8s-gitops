---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: odoo-weekly
  namespace: velero
spec:
  # Weekly Sunday 04:00 UTC (15:00 AEDT) - 1 hour after CNPG backup
  schedule: "0 4 * * 0"
  template:
    # Backup business-system namespace
    includedNamespaces:
      - business-system

    # Include specific resources
    includedResources:
      - persistentvolumeclaims
      - persistentvolumes
      - pods
      - deployments
      - statefulsets
      - configmaps
      - secrets

    # Label selector for Odoo resources
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: odoo

    # Snapshot PVCs
    snapshotVolumes: true
    storageLocation: gcs
    volumeSnapshotLocations:
      - csi-ceph-blockpool

    # Retention: 30 days (keep ~4 weekly backups)
    ttl: 720h

    # Hooks enabled via pod annotations
    hooks:
      resources: []

  useOwnerReferencesInBackup: false
