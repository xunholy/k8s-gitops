---
# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: '3.41.0'

vars:
  CLUSTER: cluster-00
  GITHUB_USER: xunholy
  GITHUB_REPO: k8s-gitops
  GITHUB_BRANCH: main

includes:
  fluxcd: .taskfiles/bootstrap
  core: .taskfiles/core
  flux: .taskfiles/flux
  docs: .taskfiles/mkdocs
  odoo: .taskfiles/odoo
  talos: .taskfiles/talos

tasks:
  flux:
    desc: "Install Fluxv2 into a cluster"
    cmds:
      - task: flux:secrets
      - task: flux:bootstrap

  git:sync:
    desc: "Rebase master onto upstream/main and push to origin"
    cmds:
      - git fetch upstream
      - git checkout master
      - git rebase upstream/main
      - git push --force-with-lease origin master
